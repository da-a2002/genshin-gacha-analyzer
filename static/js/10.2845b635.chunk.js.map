{"version":3,"sources":["components/CanvasDataGrid.tsx","components/WorkSheet.tsx","pages/ShowPage/ShowData/Filter/ButtonSelect.tsx","pages/ShowPage/ShowData/Filter/PoolSelect.tsx","pages/ShowPage/ShowData/Filter/index.tsx","pages/ShowPage/ShowData/index.tsx"],"names":["scaleToWidth","grid","self","style","width","sbw","scrollBarWidth","scrollBarBorderWidth","scrollBox","dataWidth","widthBoxRatio","verticalBarVisible","showWidth","bar","v","x","scale","left","CanvasDataGrid","data","schema","attributes","onCreate","props","divEl","useRef","gridRef","useEffect","current","timer","setTimeout","canvasDataGrid","parentNode","scrollBarBoxWidth","clearTimeout","dispose","ref","editable","allowColumnResize","allowRowResize","orderBy","touchZoomMin","touchZoomMax","WorkSheet","handleCreate","useCallback","node","oldStringSorter","sorters","string","columnName","direction","sortTime","sortCount","number","l","r","info","addEventListener","e","star","row","ctx","fillStyle","COLOR","FOUR_STAR","FIVE_STAR","height","ISMOBILE","canvas","margin","cellHorizontalAlignment","activeCellHorizontalAlignment","columnHeaderCellHorizontalAlignment","font","FONT_FAMILY","cellFont","activeCellFont","columnHeaderCellFont","rowHeaderCellFont","cellColor","activeCellColor","css","buttonStyle","Item","children","onClick","enable","type","borderColor","borderWidth","background","ButtonSelect","value","onChange","Array","isArray","map","reactNode","name","isEnable","includes","index","indexOf","splice","push","Option","Select","makeKey","pool","five","join","PoolSelect","pools","handleChange","realValue","useMemo","idx","placeholder","allowClear","from","makeFilterByArray","array","format","expr","Function","makeFilterByForm","values","matchs","search","length","mapping","weapon","character","compare","key","类别","parseInt","星级","date","to","filterFor","filterRegExp","pattern","exec","flags","substring","flagLength","RegExp","test","toString","toLocaleUpperCase","filterString","名称","undefined","every","func","Filter","activeKey","useState","visible","setVisible","count","setCount","Form","useForm","form","handleVisibleChange","object","getFieldsValue","Object","filter","handleFormChange","setFields","CHARACTER_POOLS","WEAPON_POOLS","handleFinish","handleReset","resetFields","content","layout","onFinish","initialValue","color","hidden","htmlType","trigger","placement","title","onVisibleChange","icon","TabPane","Tabs","ShowData","onGetData","tabs","useCacheState","setActiveKey","setFilter","handleFilterChange","canvasDataRef","handleCreateWorkSheet","handleGoTop","scrollTop","handleGoBottom","scrollHeight","size","centered","tab","SHOW_DATA_ALL_KEY","IconButton","tip","SCHEMA_ALL","SCHEMA"],"mappings":"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","file":"static/js/10.2845b635.chunk.js","sourcesContent":["/** @jsxImportSource @emotion/react */\nimport React, { FC, useEffect, useRef } from 'react';\n// @ts-ignore\nimport canvasDataGrid from 'canvas-datagrid';\n\ntype CanvasDataGridProps = {\n  onCreate?: (grid: any) => void; // 获取最初的参数\n  attributes?: {\n    [key: string]: any;\n  };\n  data: Array<any> | undefined;\n  schema?: Array<any>;\n};\n// 给予canvas-datagrid一个缩放，令x轴方向不出现滚动条\nfunction scaleToWidth(grid: any) {\n  if (!grid.self) return;\n  if (grid.style.width === 'auto') return;\n  const sbw = grid.style.scrollBarWidth * 2 * grid.style.scrollBarBorderWidth * 2;\n  const { scrollBox } = grid.self;\n  let dataWidth = scrollBox.width / scrollBox.widthBoxRatio;\n  if (scrollBox.verticalBarVisible) dataWidth -= sbw;\n  const showWidth = scrollBox.bar.v.x;\n  grid.self.scale *= showWidth / (dataWidth + scrollBox.left);\n}\nexport const CanvasDataGrid: FC<\n  CanvasDataGridProps & React.HTMLAttributes<HTMLDivElement>\n> = function ({ data, schema, attributes, onCreate, ...props }) {\n  const divEl = useRef(null);\n  const gridRef = useRef(null);\n  useEffect(() => {\n    if (gridRef.current) {\n      const grid: any = gridRef.current;\n      grid.schema = schema;\n      scaleToWidth(grid);\n    }\n  }, [schema]);\n  useEffect(() => {\n    if (gridRef.current) {\n      (gridRef.current as any).data = data;\n    }\n  }, [data]);\n  useEffect(() => {\n    let grid: any;\n    const timer = setTimeout(() => {\n      grid = canvasDataGrid({\n        parentNode: divEl.current,\n        schema: schema,\n        ...attributes,\n      });\n      grid.style.scrollBarBoxWidth = 10;\n      grid.style.scrollBarWidth = 13;\n      onCreate && onCreate(grid);\n      scaleToWidth(grid);\n      gridRef.current = grid;\n      setTimeout(() => {\n        if (gridRef.current) (gridRef.current as any).data = data;\n      });\n    });\n    return () => {\n      clearTimeout(timer);\n      if (gridRef.current) {\n        (gridRef.current as any).dispose();\n        delete (gridRef.current as any).self;\n      }\n    };\n  }, []);\n  return <div ref={divEl} {...props}></div>;\n};\n","/** @jsxImportSource @emotion/react */\nimport { css } from '@emotion/react';\nimport { COLOR, FONT_FAMILY, ISMOBILE } from 'const';\nimport React, { FC, useCallback } from 'react';\nimport { CanvasDataGrid } from './CanvasDataGrid';\n\ntype WorkSheetProps = {\n  data: Array<any>;\n  schema: SchemaType;\n  onCreate?: (grid: any) => void;\n};\n\ntype SchemaType = Array<{\n  name?: string;\n  type?: string;\n  title?: string;\n  width?: number;\n  hidden?: boolean;\n  filter?: (e: any) => boolean;\n  formatter?: (e: any) => any;\n  defaultValue?: any;\n}>;\n\nconst attributes = {\n  editable: false,\n  allowColumnResize: false,\n  allowRowResize: false,\n  orderBy: '时间',\n  touchZoomMin: 0.5,\n  touchZoomMax: 1.5,\n};\nexport const WorkSheet: FC<WorkSheetProps> = function ({ data, schema, onCreate }) {\n  const handleCreate = useCallback((node: any) => {\n    if (process.env.NODE_ENV === 'development') (window as any).node = node;\n    const oldStringSorter = node.sorters.string;\n    // sortBy 时间\n    node.sorters.string = function (columnName: string, direction: string) {\n      if (columnName === '时间') {\n        const sortTime = oldStringSorter(columnName, direction);\n        const sortCount = node.sorters.number('总次数', direction);\n        return (l: any, r: any) => {\n          const info = sortTime(l, r);\n          return info === 0 ? sortCount(l, r) : info;\n        };\n      } else return oldStringSorter(columnName, direction);\n    };\n    // render color:\n    node.addEventListener('rendertext', function (e: any) {\n      const star = e.row['星级'];\n      if (star === 4) {\n        e.ctx.fillStyle = COLOR.FOUR_STAR;\n      } else if (star === 5) {\n        e.ctx.fillStyle = COLOR.FIVE_STAR;\n      }\n    });\n    node.style.height = '100%';\n    if (ISMOBILE) node.style.width = '100%';\n    node.canvas.style.margin = '0 auto';\n    node.style.cellHorizontalAlignment = 'center';\n    node.style.activeCellHorizontalAlignment = 'center';\n    node.style.columnHeaderCellHorizontalAlignment = 'center';\n    const font = '16px ' + FONT_FAMILY;\n    node.style.cellFont = font;\n    node.style.activeCellFont = font;\n    node.style.columnHeaderCellFont = font;\n    node.style.rowHeaderCellFont = font;\n    node.style.cellColor = '#262626';\n    node.style.activeCellColor = '#262626';\n    onCreate && onCreate(node);\n  }, []);\n  return (\n    <CanvasDataGrid\n      css={css`\n        width: 100%;\n        height: 100%;\n        position: relative;\n        overflow-y: hidden;\n        overflow-x: auto;\n        border-bottom: 2px dotted thistle;\n      `}\n      onCreate={handleCreate}\n      data={data}\n      schema={schema}\n      attributes={attributes}\n    />\n  );\n};\n","/**\n * 按钮选择器。效果类似于checkBox\n */\n/** @jsxImportSource @emotion/react */\nimport { css } from '@emotion/react';\nimport { Button } from 'antd';\nimport React, { FC } from 'react';\n\nexport type ButtonSelectProps = {\n  value?: string[];\n  onChange?: (value: string[]) => void;\n};\ntype ButtonSelectItemProps = {\n  name: string;\n  enable?: boolean;\n  onClick?: (e: any) => void;\n};\nconst buttonStyle = css`\n  margin: 2px 12px 2px 2px;\n  border-radius: 5px;\n`;\ninterface ButtonSelectInterface extends FC<ButtonSelectProps> {\n  Item: FC<ButtonSelectItemProps>;\n}\n\nconst Item: FC<ButtonSelectItemProps> = function ({ children, onClick, enable }) {\n  return (\n    <Button\n      type='text'\n      css={buttonStyle}\n      style={\n        enable\n          ? {\n              borderColor: '#1890ff',\n              borderWidth: '2px',\n              background: '#f0f0f0',\n            }\n          : {\n              borderColor: 'transparent',\n              borderWidth: '2px',\n              background: '#f5f5f5',\n            }\n      }\n      onClick={onClick}\n    >\n      {children}\n    </Button>\n  );\n};\nexport const ButtonSelect: ButtonSelectInterface = function ({ value = [], children, onChange }) {\n  return (\n    <>\n      {(Array.isArray(children) ? children : [children]).map((reactNode: any) => {\n        const name = reactNode.props.name;\n        const isEnable = value && value.includes(name);\n        return (\n          <Item\n            key={name}\n            name={name}\n            enable={isEnable}\n            onClick={(e) => {\n              const data = [...value];\n              if (!isEnable) data.push(name);\n              else {\n                const index = data.indexOf(name);\n                if (index > -1) data.splice(index, 1);\n              }\n              onChange && onChange(data);\n            }}\n          >\n            {reactNode.props.children}\n          </Item>\n        );\n      })}\n    </>\n  );\n};\n\nButtonSelect.Item = Item;\n","/**\n * 池子选择项, 默认的Select只是string或number，在此传回对象\n */\n/** @jsxImportSource @emotion/react */\nimport { css } from '@emotion/react';\nimport { Select } from 'antd';\nimport React, { FC, useCallback, useMemo } from 'react';\nimport { PoolType } from 'types';\n\nexport type PoolSelectProps = {\n  pools: PoolType[];\n  value?: string | undefined;\n  onChange?: (value: any) => void;\n};\nconst { Option } = Select;\nconst makeKey = (pool: PoolType) => `${pool.name}(${pool.five.join('、')})`;\nexport const PoolSelect: FC<PoolSelectProps> = function ({ pools, value, onChange }) {\n  const handleChange = useCallback(\n    (index) => {\n      onChange && onChange(pools[index]);\n    },\n    [pools],\n  );\n  const realValue = useMemo(() => {\n    const idx = pools.indexOf(value as any);\n    if (idx > -1) return idx;\n    return undefined;\n  }, [value, pools]);\n  return (\n    <Select placeholder='--选择UP池--' onChange={handleChange} allowClear value={realValue}>\n      {pools.map((pool, index) => (\n        <Option value={index} key={pool.from}>\n          {makeKey(pool)}\n        </Option>\n      ))}\n    </Select>\n  );\n};\n","/** @jsxImportSource @emotion/react */\nimport { css } from '@emotion/react';\nimport { Button, Input, Popover, Form } from 'antd';\nimport { ButtonSelect } from './ButtonSelect';\nimport { CHARACTER_POOLS, WEAPON_POOLS, COLOR } from 'const';\nimport React, { FC, useCallback, useState, useMemo, useEffect } from 'react';\nimport FilterOutlined from '@ant-design/icons/FilterOutlined';\nimport { PoolSelect } from './PoolSelect';\nimport { DataItem } from 'types';\n\ntype FilterProps = {\n  activeKey?: string;\n  onChange?: (values: any) => any;\n  [key: string]: any;\n};\n// 根据值数组 做一个filter\nfunction makeFilterByArray(array: any[], format?: (v: any) => any) {\n  const handle = (v: any) => (typeof v === 'string' ? '\"' + v + '\"' : v);\n  const expr =\n    'return ' + array.map((value) => `v===${handle(format ? format(value) : value)}`).join('||');\n  return new Function('v', expr);\n}\n// 测试字符串是不是值的一部分，支持正则\nconst filterString = function (value: string, filterFor: string) {\n  var filterRegExp,\n    regEnd = /\\/(i|g|m)*$/,\n    pattern = regEnd.exec(filterFor),\n    flags = pattern ? pattern[0].substring(1) : '',\n    flagLength = flags.length;\n  if (filterFor.substring(0, 1) === '/' && pattern) {\n    try {\n      filterRegExp = new RegExp(filterFor.substring(1, filterFor.length - (flagLength + 1)), flags);\n    } catch (e) {\n      return;\n    }\n    return filterRegExp.test(value);\n  }\n  return value.toString\n    ? value.toString().toLocaleUpperCase().indexOf(filterFor.toLocaleUpperCase()) !== -1\n    : false;\n};\n// 根据form的值， 做一个filter\nfunction makeFilterByForm(values: {\n  pool?: {\n    from: number;\n    to: number;\n  };\n  search?: string;\n  star: string[];\n  type: string[];\n}) {\n  const matchs: any[] = [];\n  const { type = [], star = [], search, pool } = values;\n  if (type.length !== 0) {\n    const mapping = {\n      weapon: '武器',\n      character: '角色',\n    };\n    const compare = makeFilterByArray(type, (key: keyof typeof mapping) => mapping[key]);\n    matchs.push((data: DataItem) => compare(data.类别));\n  }\n  if (star.length !== 0) {\n    const compare = makeFilterByArray(star, (key: string) => parseInt(key));\n    matchs.push((data: DataItem) => compare(data.星级));\n  }\n  if (pool) matchs.push((data: DataItem) => data.date >= pool.from && data.date <= pool.to);\n\n  if (search) matchs.push((data: DataItem) => filterString(data.名称, search));\n\n  return matchs.length === 0\n    ? undefined\n    : (data: DataItem) => {\n        return matchs.every((func) => func(data));\n      };\n}\n// 计算当前筛选条目有几个\nfunction countObjectProperty(object: any): number {\n  return Object.values(object).filter((v) => {\n    if (v === undefined || v === '' || (Array.isArray(v) && v.length === 0)) return false;\n    return true;\n  }).length;\n}\nexport const Filter: FC<FilterProps> = function ({ activeKey, onChange, ...props }) {\n  const [visible, setVisible] = useState(false);\n  const [count, setCount] = useState(0);\n  const [form] = Form.useForm();\n  const handleVisibleChange = useCallback((v) => {\n    setVisible(v);\n    setCount(countObjectProperty(form.getFieldsValue(true)));\n  }, []);\n  const handleFormChange = useCallback((v?: any) => {\n    onChange && onChange(makeFilterByForm(v || form.getFieldsValue(true)));\n  }, []);\n  const pools = useMemo(() => {\n    // 切换页面时应重置filter\n    form.setFields([\n      {\n        name: 'pool',\n        value: undefined,\n      },\n    ]);\n    handleFormChange();\n    switch (activeKey) {\n      case '角色活动祈愿':\n      case 'Character Event Wish':\n        return CHARACTER_POOLS;\n      case '武器活动祈愿':\n      case 'Weapon Event Wish':\n        return WEAPON_POOLS;\n      default:\n        return [];\n    }\n  }, [activeKey]);\n  const handleFinish = useCallback((values: any) => {\n    handleFormChange(values);\n    handleVisibleChange(false);\n  }, []);\n  const handleReset = useCallback((values: any) => {\n    form.resetFields();\n    handleFormChange();\n    handleVisibleChange(false);\n  }, []);\n  const content = (\n    <Form\n      layout='vertical'\n      css={css`\n        max-width: 260px;\n      `}\n      onFinish={handleFinish}\n      form={form}\n    >\n      <Form.Item name='search'>\n        <Input placeholder='搜索名称请输入...' />\n      </Form.Item>\n      <Form.Item name='type' initialValue={[]}>\n        <ButtonSelect>\n          <ButtonSelect.Item name='weapon'>武器</ButtonSelect.Item>\n          <ButtonSelect.Item name='character'>角色</ButtonSelect.Item>\n        </ButtonSelect>\n      </Form.Item>\n      <Form.Item name='star' initialValue={[]}>\n        <ButtonSelect>\n          <ButtonSelect.Item name='3'>\n            <div>三星</div>\n          </ButtonSelect.Item>\n          <ButtonSelect.Item name='4'>\n            <div style={{ color: COLOR.FOUR_STAR }}>四星</div>\n          </ButtonSelect.Item>\n          <ButtonSelect.Item name='5'>\n            <div style={{ color: COLOR.FIVE_STAR }}>五星</div>\n          </ButtonSelect.Item>\n        </ButtonSelect>\n      </Form.Item>\n      <Form.Item name='pool' hidden={pools.length === 0}>\n        <PoolSelect pools={pools} />\n      </Form.Item>\n      <Form.Item\n        css={css`\n          .ant-form-item-control-input-content {\n            display: flex;\n            justify-content: space-between;\n          }\n        `}\n      >\n        <Button onClick={handleReset}>重置</Button>\n        <Button type='primary' htmlType='submit'>\n          确认\n        </Button>\n      </Form.Item>\n    </Form>\n  );\n  return (\n    <Popover\n      content={content}\n      trigger='click'\n      placement='bottomLeft'\n      title='筛选(以下均不是必填项)'\n      visible={visible}\n      onVisibleChange={handleVisibleChange}\n    >\n      <Button type='primary' icon={<FilterOutlined />} {...props}>\n        筛选{count === 0 ? '' : `(${count})`}\n      </Button>\n    </Popover>\n  );\n};\n","/** @jsxImportSource @emotion/react */\nimport { css } from '@emotion/react';\nimport React, { FC, useCallback, useMemo, useRef, useState } from 'react';\nimport { Tabs } from 'antd';\nimport UpOutlined from '@ant-design/icons/UpOutlined';\nimport DownOutlined from '@ant-design/icons/DownOutlined';\nimport { ISMOBILE, SCHEMA, SCHEMA_ALL, SHOW_DATA_ALL_KEY } from 'const';\nimport { WorkSheet } from 'components/WorkSheet';\nimport { Filter } from './Filter';\nimport { IconButton } from 'components/IconButton';\nimport { useCacheState } from 'context/CacheContext';\n\ntype ShowDataProps = {\n  onGetData: (key: string) => any;\n  tabs: Array<string>;\n};\nconst { TabPane } = Tabs;\n\nexport const ShowData: FC<ShowDataProps> = function ({ onGetData, tabs }) {\n  const [activeKey, setActiveKey] = useCacheState(tabs[0], 'activeKey');\n  const handleChange = useCallback((key) => {\n    setActiveKey(key);\n  }, []);\n  // filter为函数，因此不能直接使用useState，为了页面能更新，不使用ref\n  const [filter, setFilter] = useState<{\n    current: any;\n  }>({\n    current: void 0,\n  });\n  const handleFilterChange = useCallback((filter) => {\n    setFilter({\n      current: filter,\n    });\n  }, []);\n  const data = useMemo(() => {\n    const data = onGetData(activeKey);\n    if (!filter.current) return data;\n    return data.filter(filter.current);\n  }, [filter.current, activeKey]);\n  const canvasDataRef = useRef();\n  const handleCreateWorkSheet = useCallback((node) => {\n    canvasDataRef.current = node;\n  }, []);\n  const handleGoTop = useCallback(() => {\n    if (canvasDataRef.current) (canvasDataRef.current as any).scrollTop = 0;\n  }, []);\n  const handleGoBottom = useCallback(() => {\n    const node: any = canvasDataRef.current;\n    if (node) node.scrollTop = node.scrollHeight;\n  }, []);\n  return (\n    <div\n      css={css`\n        position: absolute;\n        width: 100%;\n        height: 100%;\n        display: flex;\n        flex-direction: column;\n        padding-bottom: ${ISMOBILE ? 0 : 20}px;\n      `}\n    >\n      <Tabs\n        activeKey={activeKey}\n        onChange={handleChange}\n        size={ISMOBILE ? 'middle' : 'large'}\n        centered\n        css={\n          ISMOBILE\n            ? css`\n                background: #fff;\n                padding: 0 10px;\n                .ant-tabs-nav {\n                  background: #fff;\n                  height: 48px;\n                }\n              `\n            : css`\n                .ant-tabs-nav {\n                  background: #fff;\n                  height: 64px;\n                }\n              `\n        }\n      >\n        {tabs.map((name: string) => (\n          <TabPane tab={name} key={name} />\n        ))}\n        <TabPane tab={SHOW_DATA_ALL_KEY} key={SHOW_DATA_ALL_KEY} />\n      </Tabs>\n      <Filter\n        css={css`\n          position: absolute;\n          top: ${ISMOBILE ? 56 : 68}px;\n          z-index: 999;\n        `}\n        onChange={handleFilterChange}\n        activeKey={activeKey}\n      />\n      {!ISMOBILE && (\n        <div\n          css={css`\n            position: absolute;\n            right: 10%;\n            z-index: 999;\n            top: 72px;\n          `}\n        >\n          <IconButton\n            placement='right'\n            tip='前往顶部'\n            icon={<UpOutlined />}\n            onClick={handleGoTop}\n          />\n          <br />\n          <IconButton\n            placement='right'\n            tip='前往底部'\n            icon={<DownOutlined />}\n            onClick={handleGoBottom}\n          />\n        </div>\n      )}\n      <WorkSheet\n        data={data}\n        schema={activeKey === SHOW_DATA_ALL_KEY ? SCHEMA_ALL : SCHEMA}\n        onCreate={handleCreateWorkSheet}\n      />\n    </div>\n  );\n};\n"],"sourceRoot":""}