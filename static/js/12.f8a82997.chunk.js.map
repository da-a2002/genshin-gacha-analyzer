{"version":3,"sources":["components/PieChart.tsx","pages/ShowPage/AnalysisChart/utils.ts","pages/ShowPage/AnalysisChart/PoolAnalysis.tsx","pages/ShowPage/AnalysisChart/renderToCanvas.tsx","components/WordCloud.tsx","pages/ShowPage/AnalysisChart/WordCloudChart/index.tsx","pages/ShowPage/AnalysisChart/index.tsx"],"names":["echarts","TitleComponent","TooltipComponent","LegendComponent","EchartsPieChart","CanvasRenderer","PieChart","onCreate","props","echartsWrapperRef","useRef","useEffect","myChart","resize","current","throttle","window","addEventListener","dispose","removeEventListener","ref","timeFormatter","date","Date","toLocaleDateString","percent","num","total","Math","round","percentColors","pct","color","r","g","b","getColorByPercent","i","length","lower","upper","range","rangePct","pctLower","pctUpper","floor","join","PoolAnalysis","sheetName","data","info","useCacheMemo","poolMax","indexOf","isWeaponPool","keys","langs","colors","colorByKey","Object","fromEntries","map","key","index","countByKey","langByKey","fiveStarHistory","forEach","item","星级","push","类别","isWeapon","lastFiveStar","takeRight","leftCount","lastIndexOf","chartDataList","filter","chartData","value","name","chartColors","chartSelected","fromTime","toTime","totalCount","fiveStarCount","fourStarCount","threeStarCount","fiveStarAverage","meanBy","o","保底内","chartRef","handlePieChartCreate","useCallback","chart","textStyle","fontFamily","FONT_FAMILY","fontStyle","setOption","title","text","left","tooltip","trigger","legend","top","selected","series","type","startAngle","radius","getColorByCount","count","renderPercent","style","css","renderColor","COLOR","FIVE_STAR","FOUR_STAR","THREE_STAR","名称","总次数","renderItem","toFixed","getFont","size","isChangeLineChar","char","drawText","ctx","restore","width","letterSpace","lineHeight","setup","loc","x","y","undefined","match","font","Error","parseFloat","fromattedText","Array","isArray","maxWidth","changeLine","max","walk","charWidth","measureText","textItem","str","draw","sx","sy","fillText","height","colorText","before","fillStyle","WIDTH","HEIGHT","renderTextContent","baseTextSet","rawStringArr","drawTextByTag","resetCanvas","textBaseline","textAlign","colorCount","dateWidth","dateHeight","drawDate","infoHeight","drawInfo","starWidth","starHeight","drawStarCount","drawExtraInfo","drawPercent","fiveStarHistoryHeight","drawHistory","averageHeight","drawAverage","CONTENT_WIDTH","drawEndLine","fontWidth","drawLink","strokeStyle","lineCap","lineWidth","centerY","beginPath","moveTo","lineTo","closePath","stroke","defaultFormatter","WordCloud","list","formatter","canvasRef","tooltipRef","useState","setTooltip","tooltipVisible","setTooltipVisible","visibleRef","hover","useMemo","dimension","event","tootipEl","innerHTML","getBoundingClientRect","clientX","clientY","document","body","clientWidth","clientHeight","offsetX","min","offsetY","timer","setTimeout","wordCloud","gridSize","backgroundColor","rotateRatio","drawOutOfBound","shrinkToFit","clearTimeout","zIndex","opacity","dangerouslySetInnerHTML","__html","WordCloudChart","filters","initialValue","initialList","isSelected","checkedList","setCheckedList","handleChange","filteredList","filterArr","v","find","some","reduce","acc","cur","pow","Group","options","onChange","AnalysisChart","sheetNames","onGetData","dataArr","validSheetNames","wordCloudData","SHOW_DATA_ALL_KEY","countMap","star","randomColor","luminosity","isCharacter","weapons","characters","values","sorter","a","getWordCloudList","sort","weaponList","characterList","wordCloudWrapperRef","localCache","useCacheContext","isVertical","useGlobalContext","handleRenderWordCloudPng","renderPngTip","resolve","reject","canvasCollection","getElementsByTagName","canvas1","selfWidth","selfHeight","canvas","createElement","getContext","currentCanvas","drawImage","toBlob","blob","saveAs","handleRenderPng","infoList","callback","tempCanvas","renderer","animation","PADDING","TOP","LEFT","RIGHT","BOTTOM","draws","maxHeight","cacheCanvas","cacheCtx","contentHeight","drawContent","endLineHeight","drawEndLink","canvasWidth","canvasHeight","fillRect","renderToCanvas","target","href","ISMOBILE","onClick","icon","shape","IconButton","tip","placement","slice","FriendLinks","mode"],"mappings":"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","file":"static/js/12.f8a82997.chunk.js","sourcesContent":["/** @jsxImportSource @emotion/react */\nimport { FC, useEffect, useRef } from 'react';\nimport * as echarts from 'echarts/core';\nimport { TitleComponent, TooltipComponent, LegendComponent } from 'echarts/components';\nimport { PieChart as EchartsPieChart } from 'echarts/charts';\nimport { CanvasRenderer } from 'echarts/renderers';\nimport { ECharts } from 'echarts/core';\nimport throttle from 'lodash/throttle';\n\necharts.use([TitleComponent, TooltipComponent, LegendComponent, EchartsPieChart, CanvasRenderer]);\n\ninterface PieChartProps {\n  onCreate: (chart: ECharts) => void;\n  [key: string]: any;\n}\n\nexport const PieChart: FC<PieChartProps> = ({ onCreate, ...props }) => {\n  const echartsWrapperRef = useRef<HTMLDivElement>(null);\n  useEffect(() => {\n    let myChart: ECharts;\n    let resize: any;\n    if (echartsWrapperRef.current) {\n      myChart = echarts.init(echartsWrapperRef.current);\n      onCreate(myChart);\n      resize = throttle(() => {\n        myChart.resize();\n      }, 100);\n      window.addEventListener('resize', resize);\n    }\n    return () => {\n      if (myChart) {\n        myChart.dispose();\n        window.removeEventListener('resize', resize);\n      }\n    };\n  }, []);\n  return <div ref={echartsWrapperRef} {...props}></div>;\n};\n","export const timeFormatter = (date: number) => new Date(date).toLocaleDateString();\n\nexport const percent = (num: number, total: number) => {\n  return `${Math.round((num / total) * 10000) / 100}%`;\n};\n\nvar percentColors = [\n  { pct: 0.0, color: { r: 46, g: 200, b: 5 } },\n  { pct: 0.77, color: { r: 67, g: 93, b: 250 } },\n  { pct: 1.0, color: { r: 0xff, g: 0, b: 0 } },\n];\n\nexport var getColorByPercent = function (pct: number) {\n  for (var i = 1; i < percentColors.length - 1; i++) {\n    if (pct < percentColors[i].pct) {\n      break;\n    }\n  }\n  var lower = percentColors[i - 1];\n  var upper = percentColors[i];\n  var range = upper.pct - lower.pct;\n  var rangePct = (pct - lower.pct) / range;\n  var pctLower = 1 - rangePct;\n  var pctUpper = rangePct;\n  var color = {\n    r: Math.floor(lower.color.r * pctLower + upper.color.r * pctUpper),\n    g: Math.floor(lower.color.g * pctLower + upper.color.g * pctUpper),\n    b: Math.floor(lower.color.b * pctLower + upper.color.b * pctUpper),\n  };\n  return 'rgb(' + [color.r, color.g, color.b].join(',') + ')';\n  // or output as hex if preferred\n};\n","/** @jsxImportSource @emotion/react */\nimport { css } from '@emotion/react';\nimport { PieChart } from 'components/PieChart';\nimport { COLOR, FONT_FAMILY } from 'const';\nimport { ECharts } from 'echarts/core';\nimport takeRight from 'lodash/takeRight';\nimport meanBy from 'lodash/meanBy';\nimport { FC, useCallback, useEffect, useMemo, useRef } from 'react';\nimport { DataItem } from 'types';\nimport { timeFormatter, percent, getColorByPercent } from './utils';\nimport { useCacheMemo } from 'context/CacheContext';\n\ninterface PoolAnalysisProps {\n  sheetName: string;\n  data: DataItem[];\n}\n\nexport const PoolAnalysis: FC<PoolAnalysisProps> = ({ sheetName, data }) => {\n  const info = useCacheMemo(\n    () => {\n      // 解析数据\n      const isWeaponPool = (sheetName: string) => sheetName.indexOf('武器') !== -1;\n      const poolMax = isWeaponPool(sheetName) ? 80 : 90;\n      const isWeapon = (item: DataItem) => item.类别 === '武器';\n      const keys = ['character5', 'weapon5', 'character4', 'weapon4', 'weapon3'];\n      const langs = ['5星角色', '5星武器', '4星角色', '4星武器', '3星武器'];\n      const colors = ['#fac858', '#ee6666', '#5470c6', '#91cc75', '#73c0de'];\n      const colorByKey = Object.fromEntries(keys.map((key, index) => [key, colors[index]]));\n      const countByKey = Object.fromEntries(keys.map((key) => [key, 0]));\n      const langByKey = Object.fromEntries(keys.map((key, index) => [key, langs[index]]));\n      const fiveStarHistory: DataItem[] = [];\n      data.forEach((item) => {\n        if (item.星级 === 5) fiveStarHistory.push(item);\n        countByKey[`${isWeapon(item) ? 'weapon' : 'character'}${item.星级}`] += 1;\n      });\n      const lastFiveStar = fiveStarHistory.length === 0 ? null : takeRight(fiveStarHistory)[0];\n      const leftCount = lastFiveStar\n        ? data.length - data.lastIndexOf(lastFiveStar!) - 1\n        : data.length;\n      const chartDataList = keys.filter((key) => countByKey[key] !== 0);\n      const chartData = chartDataList.map((key) => ({\n        value: countByKey[key],\n        name: langByKey[key],\n      }));\n      const chartColors = chartDataList.map((key) => colorByKey[key]);\n      return {\n        name: sheetName,\n        chartSelected: {\n          [langByKey['weapon3']]: data.length > 20 ? false : true,\n        },\n        poolMax,\n        chartData,\n        chartColors,\n        fromTime: data[0].date,\n        toTime: data[data.length - 1].date,\n        totalCount: data.length,\n        leftCount,\n        fiveStarCount: fiveStarHistory.length,\n        fourStarCount: countByKey['weapon4'] + countByKey['character4'],\n        threeStarCount: countByKey['weapon3'],\n        fiveStarHistory,\n        fiveStarAverage: meanBy(fiveStarHistory, (o) => o.保底内),\n      };\n    },\n    [data],\n    sheetName,\n  );\n  const chartRef = useRef<ECharts>();\n  const handlePieChartCreate = useCallback((chart: ECharts) => {\n    chartRef.current = chart;\n    const textStyle = {\n      fontFamily: FONT_FAMILY,\n      fontStyle: 'normal',\n    };\n    chart.setOption({\n      textStyle: {\n        fontFamily: FONT_FAMILY,\n        fontStyle: 'normal',\n      },\n      title: {\n        text: info.name,\n        left: 'center',\n        textStyle,\n      },\n      tooltip: {\n        trigger: 'item',\n      },\n      legend: {\n        top: '10%',\n        left: 'center',\n      },\n    });\n  }, []);\n  useEffect(() => {\n    let chart = chartRef.current;\n    if (chart) {\n      chart.setOption({\n        legend: {\n          left: 'center',\n          selected: info.chartSelected,\n        },\n        color: info.chartColors,\n        series: [\n          {\n            name: info.name,\n            type: 'pie',\n            top: 50,\n            startAngle: 70,\n            radius: '70%',\n            data: info.chartData,\n          },\n        ],\n      });\n    }\n  }, [info]);\n  const getColorByCount = (count: number) => {\n    return getColorByPercent(count / info.poolMax);\n  };\n  function renderPercent(title: string, count: number, color?: string) {\n    return (\n      <>\n        <span style={color ? { color } : void 0}>\n          <span\n            css={css`\n              display: inline-block;\n              width: 100px;\n            `}\n          >\n            {title}：{count}\n          </span>\n          [{percent(count, info.totalCount)}]\n        </span>\n        <br />\n      </>\n    );\n  }\n  function renderColor(text: string | number, color: string) {\n    return <span style={{ color }}> {text} </span>;\n  }\n  function renderItem(item: DataItem) {\n    return (\n      <span\n        key={item.总次数}\n        style={{\n          color: getColorByCount(item.保底内),\n        }}\n        css={css`\n          margin: 4px;\n        `}\n      >\n        {item.名称}[{item.保底内}]\n      </span>\n    );\n  }\n  return (\n    <div\n      css={css`\n        display: inline-block;\n        width: 100%;\n        max-width: 450px;\n        text-align: left;\n        vertical-align: top;\n      `}\n    >\n      <PieChart\n        css={css`\n          height: 300px;\n        `}\n        onCreate={handlePieChartCreate}\n      />\n      <div\n        css={css`\n          padding: 0 50px;\n        `}\n      >\n        <p\n          css={css`\n            text-align: center;\n            span {\n              color: grey;\n            }\n          `}\n        >\n          <span>{timeFormatter(info.fromTime)}</span>\n          <span> - </span>\n          <span>{timeFormatter(info.toTime)}</span>\n        </p>\n        <p>\n          <span>\n            一共抽取{renderColor(info.totalCount, '#1890ff')}次, 已累计\n            {renderColor(info.leftCount, getColorByCount(info.leftCount))}抽未出5星\n          </span>\n        </p>\n        <p>\n          {[\n            renderPercent('5星', info.fiveStarCount, COLOR.FIVE_STAR),\n            renderPercent('4星', info.fourStarCount, COLOR.FOUR_STAR),\n            renderPercent('3星', info.threeStarCount, COLOR.THREE_STAR),\n          ]}\n        </p>\n        {info.fiveStarHistory.length !== 0 && (\n          <>\n            <p>\n              5星历史记录：\n              {info.fiveStarHistory.map((item) => renderItem(item))}\n            </p>\n            <p>\n              5星平均出货次数：\n              {renderColor(info.fiveStarAverage.toFixed(2), getColorByCount(info.fiveStarAverage))}\n            </p>\n          </>\n        )}\n      </div>\n    </div>\n  );\n};\n","/** @jsxImportSource @emotion/react */\nimport { css } from '@emotion/react';\nimport { DataItem } from 'types';\nimport * as echarts from 'echarts/core';\nimport { TitleComponent, TooltipComponent, LegendComponent } from 'echarts/components';\nimport { PieChart as EchartsPieChart } from 'echarts/charts';\nimport { CanvasRenderer } from 'echarts/renderers';\nimport { COLOR, FONT_FAMILY } from 'const';\nimport { getColorByPercent, percent, timeFormatter } from './utils';\n\necharts.use([TitleComponent, TooltipComponent, LegendComponent, EchartsPieChart, CanvasRenderer]);\n\nfunction getFont(size: number) {\n  return `${size}px ${FONT_FAMILY}`;\n}\n\n// 对canvas执行操作的函数\ntype CanvasFunc = (ctx: CanvasRenderingContext2D) => void;\n// 对canvas执行setup，如果setup返回一个函数，则返回的函数是restore\ntype CanvasSetup = (ctx: CanvasRenderingContext2D) => CanvasFunc | void;\ntype TextItem =\n  | string\n  | {\n      text: string;\n      setup?: CanvasSetup;\n    };\nconst isChangeLineChar = (char: string) => char === '\\n';\n// draw text auto change line\nfunction drawText(\n  ctx: CanvasRenderingContext2D,\n  {\n    text,\n    width,\n    letterSpace = 0,\n    lineHeight,\n    setup,\n  }: {\n    text: TextItem | TextItem[];\n    width?: number;\n    letterSpace?: number;\n    lineHeight?: number;\n    setup?: CanvasSetup;\n  },\n) {\n  const loc = {\n    x: 0,\n    y: 0,\n  };\n  let restore: any;\n  const data: Array<\n    | {\n        char: string;\n        x: number;\n        y: number;\n      }\n    | CanvasFunc\n  > = []; // 记录绘制操作，是function则是对canvas的处理，是对象则是绘制字体的坐标\n  if (setup) {\n    restore = setup(ctx);\n    data.push(setup);\n  }\n  if (lineHeight === undefined) {\n    // 获取lineHeight\n    const match = ctx.font.match(/\\d\\dpx/);\n    if (match === null) throw new Error('match error');\n    else lineHeight = parseFloat(match[0]) * 1.3;\n  }\n  const fromattedText = Array.isArray(text) ? text : [text];\n  let maxWidth = 0;\n  function changeLine() {\n    loc.y += lineHeight!;\n    maxWidth = Math.max(loc.x, maxWidth);\n    loc.x = 0;\n  }\n  // 遍历字符char\n  const walk =\n    width === undefined\n      ? function (char: string) {\n          if (isChangeLineChar(char)) return changeLine();\n          const { width: charWidth } = ctx.measureText(char);\n          data.push({\n            char,\n            x: loc.x,\n            y: loc.y,\n          });\n          loc.x += charWidth + letterSpace;\n        }\n      : function (char: string) {\n          if (isChangeLineChar(char)) return changeLine();\n          const { width: charWidth } = ctx.measureText(char);\n          if (loc.x + charWidth + letterSpace > width) {\n            changeLine();\n            walk(char);\n          } else {\n            data.push({\n              char,\n              x: loc.x,\n              y: loc.y,\n            });\n            loc.x += charWidth + letterSpace;\n          }\n        };\n  fromattedText.forEach((textItem) => {\n    let str, restore;\n    if (typeof textItem === 'string') str = textItem;\n    else {\n      str = textItem.text;\n      if (textItem.setup) {\n        restore = textItem.setup(ctx);\n        data.push(textItem.setup);\n      }\n    }\n    for (let i = 0; i < str.length; i++) {\n      walk(str[i]);\n    }\n    if (restore) {\n      restore(ctx);\n      data.push(restore);\n    }\n  });\n  if (restore) {\n    restore(ctx);\n    data.push(restore);\n  }\n  return {\n    draw(x: number, y: number) {\n      // 实际进行绘制\n      data.forEach((item) => {\n        if (typeof item === 'function') item(ctx);\n        else {\n          const { char, x: sx, y: sy } = item;\n          ctx.fillText(char, x + sx, y + sy);\n        }\n      });\n    },\n    width: maxWidth === 0 ? loc.x : maxWidth,\n    height: loc.y + lineHeight,\n  };\n}\n// 返回不同颜色字体的设置\nfunction colorText(text: string | number, color: string) {\n  return {\n    text: ' ' + text + ' ',\n    setup(ctx: CanvasRenderingContext2D) {\n      const before = ctx.fillStyle;\n      ctx.fillStyle = color;\n      return () => {\n        ctx.fillStyle = before;\n      };\n    },\n  };\n}\n// draw Text by tag function\nfunction drawTextByTag(\n  ctx: CanvasRenderingContext2D,\n  {\n    width,\n    letterSpace = 0,\n    lineHeight,\n    setup,\n  }: {\n    width?: number;\n    letterSpace?: number;\n    lineHeight?: number;\n    setup?: CanvasSetup;\n  },\n) {\n  return function (rawStringArr: any, ...list: (TextItem | TextItem[])[]) {\n    const text = [];\n    for (let i = 0; i < rawStringArr.length; i++) {\n      text.push(rawStringArr[i]);\n      if (i < list.length) {\n        const item = list[i];\n        if (Array.isArray(item)) text.push(...item);\n        else text.push(item);\n      }\n    }\n    return drawText(ctx, {\n      text,\n      width,\n      letterSpace,\n      lineHeight,\n      setup,\n    });\n  };\n}\n// 传入参数\ntype Info = {\n  name: string;\n  chartSelected: {\n    [x: string]: boolean;\n  };\n  poolMax: number;\n  chartData: {\n    value: number;\n    name: string;\n  }[];\n  chartColors: string[];\n  fromTime: number;\n  toTime: number;\n  totalCount: number;\n  leftCount: number;\n  fiveStarCount: number;\n  fourStarCount: number;\n  threeStarCount: number;\n  fiveStarHistory: DataItem[];\n  fiveStarAverage: number;\n};\nconst WIDTH = 450;\nconst HEIGHT = 325;\nconst renderTextContent = (\n  ctx: CanvasRenderingContext2D,\n  {\n    totalCount,\n    poolMax,\n    fiveStarCount,\n    fourStarCount,\n    threeStarCount,\n    fiveStarHistory,\n    fiveStarAverage,\n    fromTime,\n    toTime,\n    leftCount,\n  }: Info,\n) => {\n  const TEXT_PADDING = 15;\n  const LINE_SPACE = 4;\n  const CONTENT_WIDTH = WIDTH - 2 * TEXT_PADDING;\n  const baseTextSet = drawTextByTag(ctx, {\n    width: CONTENT_WIDTH,\n  });\n  const resetCanvas = () => {\n    ctx.font = getFont(16);\n    ctx.textBaseline = 'top';\n    ctx.textAlign = 'left';\n  };\n  const getColorByCount = (count: number) => {\n    return getColorByPercent(count / poolMax);\n  };\n  const colorCount = (count: number) => colorText(count, getColorByCount(count));\n  resetCanvas();\n  let height = 0;\n  const { width: dateWidth, height: dateHeight, draw: drawDate } = baseTextSet`${colorText(\n    `${timeFormatter(fromTime)} - ${timeFormatter(toTime)}`,\n    '#808080',\n  )}`;\n  height += dateHeight + LINE_SPACE;\n  const { width: infoWidth, height: infoHeight, draw: drawInfo } = baseTextSet`一共${colorText(\n    totalCount,\n    '#1890ff',\n  )}抽，已累计${colorCount(leftCount)}抽未出5星`;\n  height += infoHeight + LINE_SPACE;\n  const { width: starWidth, height: starHeight, draw: drawStarCount } = baseTextSet`${colorText(\n    `5星：${fiveStarCount}`,\n    COLOR.FIVE_STAR,\n  )}\\n${colorText(`4星：${fourStarCount}`, COLOR.FOUR_STAR)}\\n${colorText(\n    `3星：${threeStarCount}`,\n    COLOR.THREE_STAR,\n  )}`;\n  height += starHeight + LINE_SPACE;\n  const { draw: drawPercent } = baseTextSet`${colorText(\n    `[${percent(fiveStarCount, totalCount)}]`,\n    COLOR.FIVE_STAR,\n  )}\\n${colorText(`[${percent(fourStarCount, totalCount)}]`, COLOR.FOUR_STAR)}\\n${colorText(\n    `[${percent(threeStarCount, totalCount)}]`,\n    COLOR.THREE_STAR,\n  )}`;\n  let drawExtraInfo: any;\n  if (fiveStarHistory.length !== 0) {\n    const { height: fiveStarHistoryHeight, draw: drawHistory } = baseTextSet(\n      ['5星历史记录：'],\n      fiveStarHistory.map((item) =>\n        colorText(`${item.名称}[${item.保底内}]`, getColorByCount(item.保底内)),\n      ),\n    );\n    height += fiveStarHistoryHeight + LINE_SPACE;\n    const { height: averageHeight, draw: drawAverage } = baseTextSet`5星平均出货次数：${colorCount(\n      parseFloat(fiveStarAverage.toFixed(2)),\n    )}`;\n    height += averageHeight + LINE_SPACE;\n    drawExtraInfo = function (x: number, y: number) {\n      drawHistory(x, y);\n      drawAverage(x, y + fiveStarHistoryHeight + LINE_SPACE);\n    };\n  }\n  return {\n    width: CONTENT_WIDTH,\n    height,\n    draw(x: number, y: number) {\n      const loc = {\n        x: x + TEXT_PADDING,\n        y,\n      };\n      resetCanvas();\n      drawDate(loc.x + CONTENT_WIDTH / 2 - dateWidth / 2, loc.y);\n      loc.y += dateHeight + LINE_SPACE;\n      drawInfo(loc.x, loc.y);\n      loc.y += infoHeight + LINE_SPACE;\n      drawStarCount(loc.x, loc.y);\n      drawPercent(loc.x + starWidth + 50, loc.y);\n      loc.y += starHeight + LINE_SPACE;\n      drawExtraInfo && drawExtraInfo(loc.x, loc.y);\n    },\n  };\n};\n// 绘制尾部链接\nfunction drawEndLine(ctx: CanvasRenderingContext2D) {\n  const LINE_PADDING = 20;\n  const { width: fontWidth, height, draw: drawLink } = drawText(ctx, {\n    text: 'https://genshin-gacha-analyzer.vercel.app/',\n    letterSpace: 1,\n    setup(ctx) {\n      ctx.font = getFont(13);\n      ctx.fillStyle = '#988b81';\n      ctx.textBaseline = 'middle';\n    },\n  });\n  const HEIGHT = 20;\n  return {\n    height: HEIGHT,\n    draw(x: number, y: number, width: number) {\n      ctx.strokeStyle = '#e0d6cb';\n      ctx.lineCap = 'round';\n      ctx.lineWidth = 2;\n      const centerY = y + HEIGHT / 2;\n      ctx.beginPath();\n      ctx.moveTo(x + LINE_PADDING, centerY);\n      ctx.lineTo(x + width / 2 - fontWidth / 2 - LINE_PADDING, centerY);\n      ctx.closePath();\n      ctx.stroke();\n      ctx.beginPath();\n      ctx.moveTo(x + width / 2 + fontWidth / 2 + LINE_PADDING, centerY);\n      ctx.lineTo(x + width - LINE_PADDING, centerY);\n      ctx.closePath();\n      ctx.stroke();\n      drawLink(x + width / 2 - fontWidth / 2, centerY);\n    },\n  };\n}\n\nexport function renderToCanvas(\n  infoList: Info[],\n  isVertical = false,\n  callback: (canvas: HTMLCanvasElement, ctx: CanvasRenderingContext2D) => void,\n) {\n  const canvas: HTMLCanvasElement = document.createElement('canvas');\n  const ctx: CanvasRenderingContext2D = canvas.getContext('2d')!;\n  const tempCanvas = document.createElement('canvas'); // 用于绘制echarts\n  tempCanvas.width = WIDTH;\n  tempCanvas.height = HEIGHT;\n  const textStyle = {\n    fontFamily: FONT_FAMILY,\n    fontStyle: 'normal',\n  };\n  const chart = echarts.init(tempCanvas, {\n    renderer: 'canvas',\n    width: WIDTH,\n    height: 300,\n  });\n  chart.setOption({\n    textStyle: {\n      fontFamily: FONT_FAMILY,\n      fontStyle: 'normal',\n    },\n    title: {\n      left: 'center',\n      textStyle,\n    },\n    tooltip: {\n      trigger: 'item',\n    },\n    legend: {\n      top: '10%',\n      left: 'center',\n    },\n    animation: false,\n  });\n  const PADDING = {\n    TOP: 10,\n    LEFT: 10,\n    RIGHT: 10,\n    BOTTOM: 0,\n  };\n  const loc = {\n    x: PADDING.LEFT,\n    y: PADDING.TOP,\n  };\n  const draws: (() => any)[] = []; // 存储实际进行绘制的函数\n  let maxHeight = 0;\n  // echarts绘制到tempCanvas上，再绘制到cacheCanvas上(cacheCanvas尺寸可以绘制多个饼图作为缓存)\n  const cacheCanvas = document.createElement('canvas');\n  cacheCanvas.width = WIDTH * infoList.length;\n  cacheCanvas.height = HEIGHT;\n  const cacheCtx = cacheCanvas.getContext('2d')!;\n\n  infoList.forEach((info, index) => {\n    // 根据每个info来绘制\n    chart.setOption({\n      title: {\n        text: info.name,\n      },\n      legend: {\n        selected: info.chartSelected,\n      },\n      color: info.chartColors,\n      series: [\n        {\n          name: info.name,\n          type: 'pie',\n          top: 50,\n          startAngle: 70,\n          radius: '70%',\n          data: info.chartData,\n        },\n      ],\n    });\n    // 将echarts绘制到tempCanvas，再绘制到cacheCanvas\n    cacheCtx.drawImage(tempCanvas, 0, 0, WIDTH, HEIGHT, index * WIDTH, 0, WIDTH, HEIGHT);\n    const { height: contentHeight, draw: drawContent } = renderTextContent(ctx, info);\n    if (isVertical) {\n      maxHeight += contentHeight + HEIGHT + 10;\n    } else {\n      maxHeight = Math.max(maxHeight, contentHeight + HEIGHT);\n    }\n    (function (x: number, y: number, i: number) {\n      draws.push(() =>\n        ctx.drawImage(cacheCanvas, i * WIDTH, 0, WIDTH, HEIGHT, x, y, WIDTH, HEIGHT),\n      );\n      draws.push(() => drawContent(x, y + HEIGHT));\n    })(loc.x, loc.y, index);\n    if (isVertical) {\n      loc.y = maxHeight;\n    } else loc.x += WIDTH;\n  });\n  const { height: endLineHeight, draw: drawEndLink } = drawEndLine(ctx);\n  const canvasWidth = loc.x + PADDING.RIGHT + (isVertical ? WIDTH : 0);\n  const canvasHeight = maxHeight + endLineHeight + PADDING.TOP + PADDING.BOTTOM;\n  canvas.width = canvasWidth;\n  canvas.height = canvasHeight;\n  ctx.fillStyle = '#fff'; // #f9f9f9\n  ctx.fillRect(0, 0, canvasWidth, canvasHeight);\n  draws.forEach((draw) => draw());\n  const endLineWidth = WIDTH;\n  drawEndLink((canvasWidth - endLineWidth) / 2, canvasHeight - endLineHeight, endLineWidth);\n  callback(canvas, ctx);\n\n  // destroy\n  chart.dispose();\n  [tempCanvas, canvas, cacheCanvas].forEach((canvas) => {\n    canvas.width = 0;\n    canvas.height = 0;\n  });\n}\n","/** @jsxImportSource @emotion/react */\nimport { css } from '@emotion/react';\nimport { FONT_FAMILY } from 'const';\nimport { FC, useEffect, useMemo, useRef, useState } from 'react';\n// @ts-ignore\nimport wordCloud from 'wordcloud';\nimport throttle from 'lodash/throttle';\n\nexport interface WordCloudProps {\n  width: number | string;\n  height: number | string;\n  list: any[];\n  color?: ((name: string) => string) | string;\n  formatter?: (item: any) => string;\n  [key: string]: any;\n}\n\nfunction defaultFormatter(item: any[]) {\n  return `${item[0]} 获取次数 ${item[1]}`;\n}\nexport const WordCloud: FC<WordCloudProps> = ({\n  width,\n  height,\n  list,\n  color,\n  formatter,\n  ...props\n}) => {\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const tooltipRef = useRef<HTMLDivElement>(null);\n  const [tooltip, setTooltip] = useState<{\n    left?: number;\n    top?: number;\n    text: string;\n  }>({\n    text: '',\n  });\n  const [tooltipVisible, setTooltipVisible] = useState(false);\n  const visibleRef = useRef(tooltipVisible);\n  useEffect(() => {\n    visibleRef.current = tooltipVisible;\n  }, [tooltipVisible]);\n  const hover = useMemo(() => {\n    return throttle(function hover(item: any, dimension: any, event: MouseEvent) {\n      if (item === undefined) setTooltipVisible(false);\n      else if (Array.isArray(item)) {\n        let text = (formatter || defaultFormatter)(item);\n        const tootipEl = tooltipRef.current!;\n        if (!tootipEl) return;\n        // 确保tooltip被限制在viewport中\n        tootipEl.innerHTML = text;\n        const { width, height } = tootipEl.getBoundingClientRect();\n        const { clientX, clientY } = event;\n        const { clientWidth, clientHeight } = document.body;\n        let offsetX = Math.min(10, clientWidth - clientX - width - 30);\n        let offsetY = Math.min(20, clientHeight - clientY - height - 30);\n        if (!visibleRef.current) {\n          setTooltip({\n            text,\n          });\n        }\n        setTooltip({\n          left: event.offsetX + offsetX,\n          top: event.offsetY + offsetY,\n          text,\n        });\n        setTooltipVisible(true);\n      }\n    }, 100);\n  }, [formatter]);\n  useEffect(() => {\n    const timer = setTimeout(() => {\n      wordCloud(canvasRef.current, {\n        gridSize: 12,\n        list: list,\n        fontFamily: FONT_FAMILY,\n        color: color || 'random-dark',\n        backgroundColor: '#f9f9f9',\n        rotateRatio: 0,\n        hover,\n        drawOutOfBound: false,\n        shrinkToFit: false,\n      });\n    });\n    return () => {\n      // wordCloud.stop();\n      clearTimeout(timer);\n    };\n  }, [list, hover, color]);\n  return (\n    <div\n      css={css`\n        position: relative;\n      `}\n      {...props}\n    >\n      <canvas\n        ref={canvasRef}\n        width={width}\n        height={height}\n        css={css`\n          width: 100%;\n        `}\n      ></canvas>\n      <div\n        ref={tooltipRef}\n        css={css`\n          background-color: rgba(0, 0, 0, 0.8);\n          color: #fff;\n          padding: 5px 10px;\n          border-radius: 5px;\n          font-size: 14px;\n          line-height: 1.4;\n          transition: left 0.1s, top 0.1s, z-index 0.2s, opacity 0.2s;\n          position: absolute;\n          white-space: nowrap;\n          z-index: 999;\n        `}\n        style={{\n          left: tooltip.left,\n          top: tooltip.top,\n          zIndex: tooltipVisible ? 999 : -1,\n          opacity: tooltipVisible ? 1 : 0,\n          fontFamily: FONT_FAMILY,\n        }}\n        dangerouslySetInnerHTML={{\n          __html: tooltip.text || '',\n        }}\n      />\n    </div>\n  );\n};\n","/** @jsxImportSource @emotion/react */\nimport { css } from '@emotion/react';\nimport { Checkbox } from 'antd';\nimport { WordCloud, WordCloudProps } from 'components/WordCloud';\nimport { FC, useCallback, useMemo, useState } from 'react';\n\nexport interface WordCloudChartProps {\n  list: ListItem[];\n  filters: Filter[];\n  formatter?: (item: ListItem) => string;\n  color?: WordCloudProps['color'];\n}\n\nexport type ListItem = [\n  str: string,\n  size: number,\n  data: {\n    size: number;\n    count: number;\n    star: number;\n  },\n];\n\ntype Filter = {\n  text: string;\n  filter: (item: any) => boolean;\n  isSelected?: boolean;\n};\n\nfunction defaultFormatter(item: ListItem) {\n  const [name, size, { count }] = item;\n  return `${name} 获取次数: ${count}`;\n}\n\nexport const WordCloudChart: FC<WordCloudChartProps> = ({ list, filters, formatter, color }) => {\n  const { initialValue, initialList } = useMemo(() => {\n    return {\n      initialValue: filters.map((filter) => filter.text),\n      initialList: filters\n        .filter((filter) => !('isSelected' in filter) || filter.isSelected)\n        .map((filter) => filter.text),\n    };\n  }, []);\n  const [checkedList, setCheckedList] = useState(initialList);\n  const handleChange = useCallback((list) => {\n    setCheckedList(list);\n  }, []);\n  const filteredList = useMemo(() => {\n    const filterArr: Filter['filter'][] = [];\n    checkedList.forEach((v: string) => {\n      const data = filters.find((item) => item.text === v);\n      if (data) filterArr.push(data.filter);\n    });\n    const filter = (item: any) => filterArr.some((v) => v(item));\n    const filteredList = list.filter(filter);\n    const total = filteredList.reduce((acc, cur) => acc + cur[2].count, 0);\n    filteredList.forEach((item) => {\n      const { count, size } = item[2];\n      item[1] = 250 * size * Math.pow(count / total, 1 / 2);\n    });\n    return filteredList;\n  }, [list, checkedList]);\n  return (\n    <div\n      css={css`\n        position: relative;\n        display: inline-block;\n        width: 100%;\n        max-width: 450px;\n      `}\n    >\n      <Checkbox.Group\n        options={initialValue}\n        value={checkedList}\n        onChange={handleChange}\n        css={css`\n          position: absolute;\n          right: 0px;\n          top: -15px;\n          z-index: 9999;\n          background-color: #f0f0f0;\n          border-bottom-left-radius: 5px;\n          padding: 5px 10px;\n        `}\n      />\n      <WordCloud\n        width='800'\n        height='600'\n        list={filteredList}\n        formatter={formatter || defaultFormatter}\n        color={color}\n        css={css`\n          margin-top: 15px;\n          width: 100%;\n        `}\n      />\n    </div>\n  );\n};\n","/** @jsxImportSource @emotion/react */\nimport { css } from '@emotion/react';\nimport { Button, Divider } from 'antd';\nimport { useCacheContext, useCacheMemo } from 'context/CacheContext';\nimport { FC, useCallback, useMemo, useRef } from 'react';\nimport DownloadOutlined from '@ant-design/icons/DownloadOutlined';\nimport { DataItem } from 'types';\nimport { PoolAnalysis } from './PoolAnalysis';\nimport { renderToCanvas } from './renderToCanvas';\n// @ts-ignore\nimport { saveAs } from 'file-saver';\nimport { ISMOBILE, SHOW_DATA_ALL_KEY } from 'const';\nimport { useGlobalContext } from 'context/GlobalContext';\nimport { IconButton } from 'components/IconButton';\nimport { FriendLinks } from 'components/FriendLinks';\nimport { ListItem, WordCloudChart } from './WordCloudChart';\n// @ts-ignore\nimport randomColor from 'randomcolor';\nimport renderPngTip from 'utils/renderPngTip';\n\ninterface AnalysisChartProps {\n  sheetNames: string[];\n  onGetData: (key: string) => DataItem[];\n}\n\nexport const AnalysisChart: FC<AnalysisChartProps> = ({ sheetNames, onGetData }) => {\n  const { dataArr, validSheetNames } = useMemo(() => {\n    const dataArr: DataItem[][] = [];\n    const validSheetNames: string[] = [];\n    sheetNames.forEach((key) => {\n      const data = onGetData(key);\n      if (data && data.length !== 0) {\n        dataArr.push(data);\n        validSheetNames.push(key);\n      }\n    });\n    return {\n      dataArr,\n      validSheetNames,\n    };\n  }, [sheetNames]);\n  const wordCloudData = useCacheMemo(\n    () => {\n      const data = onGetData(SHOW_DATA_ALL_KEY);\n      type Info = {\n        count: number;\n        data: DataItem[];\n        name: string;\n        star: number;\n        color: string;\n        isCharacter: boolean;\n      };\n      const countMap: {\n        [key: string]: Info;\n      } = {};\n      data.forEach((item) => {\n        if (item.名称 in countMap) {\n          const info = countMap[item.名称];\n          info.count += 1;\n          info.data.push(item);\n        } else\n          countMap[item.名称] = {\n            count: 1,\n            data: [item],\n            name: item.名称,\n            star: item.星级,\n            color: randomColor({\n              luminosity: 'dark',\n            }),\n            isCharacter: item.类别 === '角色',\n          };\n      });\n      const weapons: Info[] = [],\n        characters: Info[] = [];\n      Object.values(countMap).forEach((v) => {\n        if (v.isCharacter) {\n          characters.push(v);\n        } else {\n          weapons.push(v);\n        }\n      });\n      const sorter = (a: Info, b: Info) => b.star - a.star || b.count - a.count;\n      weapons.sort(sorter);\n      characters.sort(sorter);\n      function getWordCloudList(data: Info[]): ListItem[] {\n        return data.map((item) => {\n          const { name, count, star } = item;\n          return [\n            name,\n            1,\n            {\n              size: 1,\n              count,\n              star,\n            },\n          ];\n        });\n      }\n      return {\n        weaponList: getWordCloudList(weapons),\n        characterList: getWordCloudList(characters),\n        filters: [3, 4, 5].map((star) => ({\n          text: `${star} 星`,\n          filter: (item: ListItem) => item[2].star === star,\n          isSelected: star === 3 ? false : true,\n        })),\n        color(name: string) {\n          if (name in countMap) {\n            const { color } = countMap[name];\n            return color;\n          }\n          return '#fff';\n        },\n      };\n    },\n    [],\n    'wordCloudData',\n  );\n  const wordCloudWrapperRef = useRef<HTMLDivElement>(null);\n  const localCache = useCacheContext();\n  const { isVertical } = useGlobalContext();\n  const handleRenderWordCloudPng = useCallback(() => {\n    renderPngTip((resolve, reject) => {\n      if (!wordCloudWrapperRef.current) return reject();\n      const canvasCollection = wordCloudWrapperRef.current.getElementsByTagName(\n        'canvas',\n      ) as HTMLCollectionOf<HTMLCanvasElement>;\n      const canvas1 = canvasCollection[0];\n      const selfWidth = canvas1.width,\n        selfHeight = canvas1.height;\n      let width, height;\n      if (isVertical) {\n        width = selfWidth;\n        height = 2 * selfHeight;\n      } else {\n        width = 2 * selfWidth;\n        height = selfHeight;\n      }\n      const canvas = document.createElement('canvas');\n      const scale = 1;\n      canvas.width = width * scale;\n      canvas.height = height * scale;\n      const ctx = canvas.getContext('2d')!;\n      const loc = {\n        x: 0,\n        y: 0,\n      };\n      for (let i = 0; i < canvasCollection.length; i++) {\n        const currentCanvas = canvasCollection[i];\n        ctx.drawImage(\n          currentCanvas,\n          0,\n          0,\n          selfWidth,\n          selfHeight,\n          loc.x * scale,\n          loc.y * scale,\n          selfWidth * scale,\n          selfHeight * scale,\n        );\n        if (isVertical) loc.y += selfHeight;\n        else loc.x += selfWidth;\n      }\n      canvas.toBlob(function (blob) {\n        saveAs(blob, 'wordCloud.png');\n        resolve();\n      });\n    });\n  }, [isVertical]);\n  const handleRenderPng = useCallback(() => {\n    renderPngTip((resolve, reject) => {\n      renderToCanvas(\n        validSheetNames.map((key: string) => localCache[key]),\n        isVertical,\n        (canvas: HTMLCanvasElement, ctx: CanvasRenderingContext2D) => {\n          canvas.toBlob(function (blob) {\n            saveAs(blob, 'charts.png');\n            resolve();\n          });\n        },\n      );\n    });\n  }, [isVertical]);\n  return (\n    <div>\n      <Divider>\n        <span>\n          此页面参考自：\n          <a target='_blank' href='https://github.com/biuuu/genshin-gacha-export'>\n            github链接\n          </a>\n        </span>\n      </Divider>\n      {ISMOBILE ? (\n        <div\n          css={css`\n            position: absolute;\n            right: 12px;\n            z-index: 999;\n          `}\n        >\n          <Button\n            type='primary'\n            onClick={handleRenderPng}\n            icon={<DownloadOutlined />}\n            size='middle'\n            shape='circle'\n          />\n        </div>\n      ) : (\n        <div\n          css={css`\n            position: fixed;\n            right: 64px;\n            z-index: 999;\n          `}\n        >\n          <IconButton\n            icon={<DownloadOutlined />}\n            onClick={handleRenderPng}\n            tip='生成图片'\n            placement='left'\n          />\n        </div>\n      )}\n      <div\n        css={css`\n          text-align: center;\n          margin: 10px 0;\n        `}\n      >\n        {validSheetNames\n          .map((key, index) => {\n            return <PoolAnalysis key={key} sheetName={key} data={dataArr[index]} />;\n          })\n          .filter((v) => !!v)}\n      </div>\n      <div\n        css={css`\n          text-align: center;\n          margin-bottom: 48px;\n        `}\n      >\n        <Button type='primary' onClick={handleRenderPng} icon={<DownloadOutlined />} size='middle'>\n          生成图片\n        </Button>\n      </div>\n      <Divider>抽取数目展示图</Divider>\n      <div\n        ref={wordCloudWrapperRef}\n        css={css`\n          text-align: center;\n          margin: 24px 0;\n        `}\n      >\n        <WordCloudChart\n          list={wordCloudData.characterList}\n          filters={wordCloudData.filters.slice(1)}\n          color={wordCloudData.color}\n        />\n        <WordCloudChart\n          list={wordCloudData.weaponList}\n          filters={wordCloudData.filters}\n          color={wordCloudData.color}\n        />\n        <br />\n        <Button\n          type='primary'\n          onClick={handleRenderWordCloudPng}\n          icon={<DownloadOutlined />}\n          size='middle'\n        >\n          生成图片\n        </Button>\n      </div>\n      <FriendLinks mode='bottom' />\n    </div>\n  );\n};\n"],"sourceRoot":""}